# Comprehensive Test Suite: hashi - 2026-01-20

## 1. Objective
To rigorously test all aspects of the `hashi` CLI tool, ensuring its correctness, reliability, performance, and adherence to documented behavior for a production-ready release. This includes thorough verification of core functionalities, argument parsing, configuration precedence, error handling, security features, and cross-platform consistency.

## 2. Scope
This comprehensive test suite covers:
-   **Functional Correctness**: All advertised features, flags, algorithms, and output formats.
-   **Integration**: Interaction with the operating system (paths, permissions, stdin/stdout), environment variables, and configuration files.
-   **Edge Cases**: Behavior with unusual inputs (empty files, very large files, special characters, non-existent paths).
-   **Error Handling**: Graceful handling and informative messages for all anticipated error conditions.
-   **Security**: Verification of path validation and write protection mechanisms.
-   **Performance (Basic)**: Qualitative assessment of performance on typical workloads.
-   **Documentation Adherence**: Alignment of actual behavior with `README.md` and `docs/user` documentation.
-   **Cross-Platform Behavior**: Identification of platform-specific behaviors (tests to be executed on target platforms as necessary).

## 3. Test Environments
This test suite focuses exclusively on the Linux environment. Dedicated test suites will be created for Windows and macOS testing at a later stage.

-   **Linux (Fedora/Ubuntu)**: Primary development and target environment.
    -   Go Version: 1.24+
    -   `hashi` version: 1.0.18

## 4. Test Categories & Cases

### Category 4.1: Installation & Setup Verification

| ID     | Description                                                                 | Steps                                                                                                                                                                                                                                                                                                                                          | Expected Result                                                                                                                                                                                           | Status    |
| :----- | :-------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------- |
| 4.1.1  | **Linux: `go install @latest`**                                             | 1. Ensure no existing `hashi` binary in `$(go env GOPATH)/bin`.<br>2. Run `go install github.com/Les-El/hashi/cmd/hashi@latest`.<br>3. Verify `hashi` binary exists.<br>4. Run `hashi --version`.<br>5. Run `hashi` (no arguments) in an empty directory.<br>6. Run `hashi` (no arguments) in a directory with various files.<br>7. Run `hashi --verbose` in a directory with files. | 1. Binary is absent.<br>2. Installation completes without errors.<br>3. Binary is present.<br>4. Outputs `hashi version X.Y.Z` (latest stable).<br>5. Exits cleanly with no output.<br>6. Outputs hashes for files.<br>7. Outputs hashes with verbose diagnostics. | Passed    |
| 4.1.2  | **Linux: Build from Source**                                                | 1. Clone repository.<br>2. Run `go build -o hashi ./cmd/hashi`.<br>3. Verify local `hashi` binary exists.<br>4. Run `./hashi --version`.<br>5. Run `./hashi` (no arguments) in current directory.                                                                                                                                                                   | 1. Repository cloned.<br>2. Build completes without errors.<br>3. Binary is present.<br>4. Outputs `hashi version X.Y.Z` (current local version).<br>5. Outputs hashes for project files.                                                 | Passed    |
| 4.1.3  | **Linux: Uninstallation `go install`**                                      | 1. Ensure `hashi` is installed via `go install`.<br>2. Run `rm "$(go env GOPATH)"/bin/hashi`.<br>3. Verify `hashi` command is no longer found.                                                                                                                                                                              | 1. `hashi --version` works.<br>2. Command executes without error.<br>3. `hashi` command returns "command not found".                                                                                                                      | Passed    |
| 4.1.4  | **Linux: Uninstallation Build from Source**                                 | 1. Ensure `hashi` is built locally.<br>2. Run `sudo rm /usr/local/bin/hashi` (if moved).<br>3. Verify `hashi` command is no longer found.                                                                                                                                                                                 | 1. Local `./hashi --version` works.<br>2. Command executes without error.<br>3. `hashi` command returns "command not found".                                                                                                                      | Passed    |
| 4.1.5  | **Linux: Removing config/log files (XDG and dotfile)**                      | 1. Create dummy `~/.config/hashi/config.toml` and `~/.hashi/config.toml`.<br>2. Run `rm -rf ~/.config/hashi` and `rm -rf ~/.hashi`.<br>3. Verify directories are removed.                                                                                                                                                   | 1. Files/dirs created.<br>2. Commands execute without error.<br>3. Directories do not exist.                                                                                                              | Passed    |

### Category 4.2: Core Hashing Functionality

| ID     | Description                                                          | Steps                                                                                                                                                                                  | Expected Result                                                                                                                                                                                 | Status    |
| :----- | :------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------- |
| 4.2.1  | **Single File Hashing (SHA256 Default)**                             | 1. Create `test.txt` with known content.<br>2. Run `hashi test.txt`.                                                                                                                  | Outputs the correct SHA256 hash for `test.txt`.                                                                                                                                                 | Passed    |
| 4.2.2  | **Multiple Files Hashing**                                           | 1. Create `file1.txt`, `file2.txt` (same content), `file3.txt` (different content).<br>2. Run `hashi file1.txt file2.txt file3.txt`.                                                 | Outputs correctly grouped hashes for `file1.txt`, `file2.txt`, and a separate hash for `file3.txt`.                                                                                            | Passed    |
| 4.2.3  | **Recursive Directory Hashing (`-r`)**                               | 1. Create `dir1` with `fileA.txt`, `dir1/subdir1` with `fileB.txt`.<br>2. Run `hashi -r dir1`.                                                                                        | Outputs hashes for `dir1/fileA.txt` and `dir1/subdir1/fileB.txt`.                                                                                                                               | Passed    |
| 4.2.4  | **Specific Algorithm (`-a md5`)**                                    | 1. Create `test.txt` with known content.<br>2. Run `hashi -a md5 test.txt`.                                                                                                          | Outputs the correct MD5 hash for `test.txt`.                                                                                                                                                    | Passed    |
| 4.2.5  | **Hidden Files (`--hidden`)**                                        | 1. Create `.hidden_file.txt` in a directory.<br>2. Run `hashi dir/` (without `--hidden`).<br>3. Run `hashi --hidden dir/`.                                                            | 2. Does not output hash for `.hidden_file.txt`.<br>3. Outputs hash for `.hidden_file.txt`.                                                                                                     | Passed    |
| 4.2.6  | **Input from Stdin (`-`)**                                           | 1. Create `fileA.txt`, `fileB.txt`.<br>2. Run `echo "fileA.txt" | hashi -`.<br>3. Run `find . -name "*.txt" | hashi -`.                                                                                                              | 2. Outputs hash for `fileA.txt`.<br>3. Outputs hashes for all `.txt` files in the current directory.                                                                                             | Passed    |
| 4.2.7  | **Hash String Validation**                                           | 1. Run `hashi e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855` (empty string SHA256).<br>2. Run `hashi "invalidhash"`.                                        | 1. Outputs "Valid hash" with algorithm detected.<br>2. Outputs "Invalid hash format" error.                                                                                                     | Passed    |
| 4.2.8  | **File vs. Hash String Comparison**                                  | 1. Create `test.txt` with known SHA256 hash.<br>2. Run `hashi test.txt [known_sha256]`.<br>3. Run `hashi test.txt [incorrect_sha256]`.                                           | 2. Outputs "PASS" or equivalent.<br>3. Outputs "FAIL" or equivalent with expected/computed hashes.                                                                                             | Passed    |
| 4.2.9  | **ZIP Archive Verification (`--verify`)**                            | 1. Create a valid `test.zip` file.<br>2. Create a corrupted `corrupted.zip` file.<br>3. Run `hashi --verify test.zip`.<br>4. Run `hashi --verify corrupted.zip`. | 3. Outputs "PASS" or "All entries passed" for integrity.<br>4. Outputs "FAIL" or "entries failed" for integrity with an error message. | Passed    |
| 4.2.10 | **ZIP Archive as Standard File (Default)**                           | 1. Create a valid `test.zip` file.<br>2. Run `hashi test.zip`.                                                                                                         | Outputs the standard hash (e.g., SHA256) of the `test.zip` file itself.                                                                                        | Passed    |
| 4.2.11 | **Output to File (`-o`)**                                            | 1. Run `hashi -o output.txt README.md`.<br>2. Check `output.txt` content.<br>3. Run `hashi -o output.txt README.md --append`.<br>4. Check `output.txt` content.<br>5. Run `hashi -o output.txt README.md --force`. | 1. Creates `output.txt` with hash.<br>2. Contains hash output.<br>3. Appends hash to `output.txt`.<br>4. Contains two hash entries.<br>5. Overwrites `output.txt` with new hash.               | Passed    |

### Category 4.3: Output Formats

| ID     | Description                                                          | Steps                                                                                                                                                                                    | Expected Result                                                                                                     | Status    |
| :----- | :------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------ | :-------- |
| 4.3.1  | **Default Output**                                                   | 1. Run `hashi file1.txt file2.txt file3.txt` (where file1/file2 match, file3 differs).                                                                                                  | Outputs grouped format: `file1.txt`, `file2.txt` under one hash, `file3.txt` under another.                           | Passed    |
| 4.3.2  | **JSON Output (`--json`)**                                           | 1. Run `hashi --json file1.txt file2.txt`.                                                                                                                                               | Outputs a JSON object containing `processed`, `duration_ms`, `match_groups`, `unmatched`, `errors` fields.          | Passed    |
| 4.3.3  | **Plain Output (`--plain`)**                                         | 1. Run `hashi --plain file1.txt file2.txt`.                                                                                                                                              | Outputs tab-separated `filename	hash` for each file.                                                               | Passed    |
| 4.3.4  | **Boolean Output (`-b`)**                                            | 1. Create `match.txt`, `match_copy.txt` (same content), `different.txt`.<br>2. Run `hashi -b match.txt match_copy.txt`.<br>3. Run `hashi -b match.txt different.txt`.                  | 2. Outputs `true`.<br>3. Outputs `false`.                                                                           | Passed    |
| 4.3.5  | **Quiet Mode (`-q`)**                                                | 1. Create `test.txt`.<br>2. Run `hashi -q test.txt`.<br>3. Run `hashi -q --match-required non_existent_file.txt` (expect exit code 1 if no match found, 0 if match found).             | 2. No standard output (only exit code).<br>3. No standard output, correct exit code (1).                             | Passed    |
| 4.3.6  | **Verbose Output (`-v`)**                                            | 1. Create a directory with multiple files.<br>2. Run `hashi -v dir/`.                                                                                                                   | Outputs hashing progress, file names, and final hashes.                                                             | Passed    |
| 4.3.7  | **Output Format Precedence**                                         | 1. Run `hashi --json --plain README.md`.<br>2. Run `hashi -b --json README.md`.                                                                                                         | 1. Should default to one (e.g., JSON, as per `--json` flag) based on precedence rules.<br>2. Outputs `true`/`false` (boolean mode has highest precedence). | Passed    |

### Category 4.4: Filtering Options

| ID     | Description                                                          | Steps                                                                                                                                                                                     | Expected Result                                                                                                                                 | Status    |
| :----- | :------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------ | :-------- |
| 4.4.1  | **Include (`-i`)**                                                   | 1. Create `file.txt`, `file.md`, `file.log`.<br>2. Run `hashi -i "*.txt" *`.                                                                                                          | Outputs hash only for `file.txt`.                                                                                                                       | Passed    |
| 4.4.2  | **Exclude (`-e`)**                                                   | 1. Create `file.txt`, `file.md`, `file.log`.<br>2. Run `hashi -e "*.log" *`.                                                                                                          | Outputs hashes for `file.txt` and `file.md`.                                                                                                            | Passed    |
| 4.4.3  | **Min Size (`--min-size`)**                                          | 1. Create `small.txt` (10 bytes), `medium.txt` (1KB), `large.txt` (1MB).<br>2. Run `hashi --min-size=1KB *`.                                                                          | Outputs hashes for `medium.txt` and `large.txt`.                                                                                                        | Passed    |
| 4.4.4  | **Max Size (`--max-size`)**                                          | 1. Create `small.txt` (10 bytes), `medium.txt` (1KB), `large.txt` (1MB).<br>2. Run `hashi --max-size=1KB *`.                                                                          | Outputs hashes for `small.txt` and `medium.txt`.                                                                                                        | Passed    |
| 4.4.5  | **Modified After (`--modified-after`)**                              | 1. Create `old.txt` (yesterday), `new.txt` (today).<br>2. Run `hashi --modified-after=YYYY-MM-DD old.txt new.txt` (with YYYY-MM-DD as yesterday's date).                               | Outputs hash only for `new.txt`.                                                                                                                        | Passed    |
| 4.4.6  | **Modified Before (`--modified-before`)**                            | 1. Create `old.txt` (yesterday), `new.txt` (today).<br>2. Run `hashi --modified-before=YYYY-MM-DD old.txt new.txt` (with YYYY-MM-DD as today's date).                                | Outputs hash only for `old.txt`.                                                                                                                        | Passed    |

### Category 4.5: Configuration & Environment Variables

| ID     | Description                                                                 | Steps                                                                                                                                                                                                                                                                                                                                                                    | Expected Result                                                                                                                                                                                           | Status    |
| :----- | :-------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------- |
| 4.5.1  | **Environment Variable Precedence (`HASHI_ALGORITHM`)**                     | 1. `export HASHI_ALGORITHM=md5`.<br>2. Run `hashi README.md`.<br>3. Run `hashi --algorithm=sha1 README.md`.<br>4. Unset `HASHI_ALGORITHM`.                                                                                                                                                                                                                 | 1. Env var set.<br>2. Outputs MD5 hash.<br>3. Outputs SHA1 hash (flag overrides env var).<br>4. Env var unset.                                                                                              | Passed    |
| 4.5.2  | **Configuration File Precedence (`./.hashi.toml`)**                         | 1. Create `.hashi.toml` in project root with `algorithm = "sha1"`.<br>2. Run `hashi README.md`.<br>3. Run `hashi --algorithm=md5 README.md`.<br>4. `export HASHI_ALGORITHM=sha256`.<br>5. Run `hashi README.md`.<br>6. Remove `.hashi.toml`.                                                                                                                      | 1. Config file created.<br>2. Outputs SHA1 hash.<br>3. Outputs MD5 hash (flag overrides config).<br>4. Env var set.<br>5. Outputs SHA256 hash (env var overrides config).<br>6. Config file removed.        | Passed    |
| 4.5.3  | **Configuration File Auto-Discovery**                                       | 1. Create config file at `~/.config/hashi/config.toml` with `output_format = "json"`.<br>2. Run `hashi README.md`.<br>3. Run `hashi --format=plain README.md`.<br>4. Remove config file.                                                                                                                                                              | 1. Config file created.<br>2. Outputs JSON.<br>3. Outputs plain text (flag overrides config).<br>4. Config file removed.                                                                                      | Passed    |
| 4.5.4  | **`NO_COLOR` Environment Variable**                                         | 1. Run `hashi file1.txt file2.txt` (with differing hashes) and observe colored output.<br>2. `export NO_COLOR=1`.<br>3. Run `hashi file1.txt file2.txt`.<br>4. Unset `NO_COLOR`.         | 1. Output shows colors.<br>2. Env var set.<br>3. Output shows no colors.<br>4. Env var unset.                                                                                              | Passed    |

### Category 4.6: Error Handling & Edge Cases

| ID     | Description                                                          | Steps                                                                                                                                                                             | Expected Result                                                                                                                                              | Status    |
| :----- | :------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------- |
| 4.6.1  | **Non-existent File/Directory**                                      | 1. Run `hashi non_existent_file.txt`.<br>2. Run `hashi -r non_existent_dir/`.                                                                                                    | 1. Outputs error message indicating file not found, exits with `ExitFileNotFound`.<br>2. Outputs error message indicating directory not found, exits with `ExitFileNotFound`. | Passed    |
| 4.6.2  | **Permission Denied**                                                | 1. Create `no_access.txt` with read permissions removed (`chmod 000 no_access.txt`).<br>2. Run `hashi no_access.txt`.<br>3. Restore permissions (`chmod 644 no_access.txt`).     | 2. Outputs error message indicating permission denied, exits with `ExitPermissionErr`.                                                                       | Passed    |
| 4.6.3  | **Invalid Algorithm**                                                | 1. Run `hashi -a invalid_algo README.md`.                                                                                                                                         | Outputs error message for invalid algorithm, exits with `ExitInvalidArgs`.                                                                                   | Passed    |
| 4.6.4  | **Invalid Flag Usage**                                               | 1. Run `hashi --non-existent-flag`.<br>2. Run `hashi --algorithm`.                                                                                                                | 1. Outputs "unknown flag" error with suggestion, exits `ExitInvalidArgs`.<br>2. Outputs "flag needs an argument" error, exits `ExitInvalidArgs`.           | Passed    |
| 4.6.5  | **Empty File Hashing**                                               | 1. Create an empty file `empty.txt`.<br>2. Run `hashi empty.txt`.                                                                                                                 | Outputs the correct hash for an empty file (e.g., SHA256 of empty string).                                                                                   | Passed    |
| 4.6.6  | **Interruption (Ctrl-C)**                                            | 1. Run `hashi -r /usr/bin` (or a long-running command).<br>2. Send `Ctrl-C` after a few seconds.                                                                          | Program terminates gracefully, with an `ExitInterrupted` code (130).                                                | Passed    |
| 4.6.7  | **Security: Output to Sensitive File (`-o .env.txt`)**               | 1. Create a dummy `.env.txt` file.<br>2. Run `hashi -o .env.txt README.md` (without `--verbose`).<br>3. Run `hashi -o .env.txt README.md --verbose`.<br>4. Delete `.env.txt`.   | 2. Outputs generic "Unknown write/append error", exits with non-zero code.<br>3. Outputs specific "security policy violation" error, exits with non-zero code. | Passed    |

### Category 4.7: Documentation & User Experience

| ID     | Description                                                          | Steps                                                                                                                                                                                                      | Expected Result                                                                                     | Status    |
| :----- | :------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------- | :-------- |
| 4.7.1  | **README.md Examples (General)**                                     | 1. For each example in the "Quick Start" section of `README.md`, execute the command as written.                                                                                                            | The output matches the behavior described in the `README.md`.                                       | Passed    |
| 4.7.2  | **README.md Exit Codes**                                             | 1. Trigger each documented exit code (e.g., for `ExitNoMatches`, `ExitFileNotFound`, `ExitInvalidArgs`).<br>2. Verify `echo $?` matches the expected code.                                              | The exit code returned by `hashi` matches the value documented in `README.md` for each scenario.    | Passed    |
| 4.7.3  | **Help Text Accuracy**                                               | 1. Compare the output of `hashi --help` with the "FLAGS" and "EXAMPLES" sections of `README.md`.<br>2. Compare flag descriptions in help text with their behavior.                                        | All flags and their descriptions in `hashi --help` are accurate and consistent with `README.md`.    | Passed    |
| 4.7.4  | **Troubleshooting Section Adherence**                                | 1. Follow the steps in the "Troubleshooting" section of `README.md` (e.g., using `--verbose` for security errors).                                                                                        | The behavior observed matches the troubleshooting guidance.                                         | Passed    |
| 4.7.5  | **Configuration Precedence Examples**                                | 1. Follow the examples in the "Configuration Precedence" section of `README.md` (e.g., env var overriding default, flag overriding env var).                                                              | The observed precedence matches the examples and descriptions.                                      | Passed    |
| 4.7.6  | **Installation Instructions Accuracy (Linux)**                       | 1. Review Linux installation steps in `README.md`.<br>2. Attempt installation on a fresh Linux environment following `README.md`.                                                                           | 1. Instructions are clear and unambiguous.<br>2. Installation proceeds as described.                | Passed    |

## 5. Test Execution & Reporting
-   **Execution**: Completed 2026-01-20.
-   **Status**: ALL LINUX TESTS PASSED.
-   **Notes**: Significant bugs were identified and fixed during deep testing. Automated test batteries were created to prevent regressions.
-   **Bugs**: 
    -   Stdin marker expansion fix (v1.0.13)
    -   ZIP verification opt-in implementation (v1.0.14)
    -   Filtering options implementation (v1.0.15)
    -   Configuration precedence fix (v1.0.16)
    -   TOML [defaults] section fix (v1.0.17)
    -   Error prefix leak fix (v1.0.18)
    -   Help text accuracy fix (v1.0.19)

## 7. Bug Fix Protocol

If a bug is identified and fixed during testing, the following protocol MUST be followed:

1.  **Document the Bug and Fix**: Provide a clear description of the bug and the technical details of the fix.

2.  **Construct an Automated Test Battery**: Create an automated test file (e.g., a shell script or Go test) that includes all previous tests in the category, up to and including the test that exposed the bug.

3.  **Verify the Battery**: Execute the automated test battery and ensure all tests pass in full before proceeding to any new tests.



## 8. Sign-off

**Tester**: Gemini CLI (on behalf of Les-El)
**Date**: 2026-01-20
**Status**: APPROVED FOR PRODUCTION RELEASE (LINUX)
